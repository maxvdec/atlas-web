---
import { readFile } from 'node:fs/promises';
import '../../styles/global.css'
import NewsArticle from '../../components/news/NewsArticle.svelte';
import type { BlogPostRaw } from '../../scripts/blog';
import { mapBlogPostRawToNewsItem } from '../../scripts/news';

export async function getStaticPaths() {
	const newsFileUrl = new URL('../../../public/news.json', import.meta.url);
	const fileContents = await readFile(newsFileUrl, 'utf-8');
	const rawItems = JSON.parse(fileContents) as BlogPostRaw[];
	return rawItems
		.map(mapBlogPostRawToNewsItem)
		.map((article) => ({
			params: { slug: article.slug },
			props: { article },
		}));
}

const { slug = '' } = Astro.params;
const { article } = Astro.props;
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Atlas News - {slug}</title>
	</head>
	<body class="bg-gray-950">
		<div>
			<NewsArticle client:load slug={slug} article={article} />
		</div>
	</body>
</html>
