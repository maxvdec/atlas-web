---
import { readFile } from 'node:fs/promises';
import '../../styles/global.css'
import ReleaseDetail from '../../components/ReleaseDetail.svelte';

const { slug } = Astro.params;

if (!slug) {
	throw new Error('Missing release identifier');
}

export async function getStaticPaths() {
	const file = await readFile(new URL('../../../public/releases.json', import.meta.url), 'utf-8');
	const config = JSON.parse(file);

	const entries = Object.keys(config.releases ?? {});

	return entries.map((key) => ({
		params: { slug: key },
	}));
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{`Atlas Engine - ${slug} release`}</title>
	</head>
	<body class="bg-gray-950">
		<div>
			<ReleaseDetail releaseKey={slug} client:load />
		</div>
	</body>
</html>
