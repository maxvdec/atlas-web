import{L as F,A as I,D as H,C as J,E as M,t as Q,I as X,_ as Z}from"./styles-d81a254a.DS2TvR1S.js";import{Y as tt}from"./graph-80608c14.OAWqsKDf.js";import{L as p,e as S,T as A,f as et,a as st,z as v}from"./mermaid.esm.min.Bb2MR6fe.js";import{b as ot}from"./index-0cdc3891.BYCgkLz5.js";import"./MarkdownExtract.DG84g7Lt.js";import"./Footer.6w1iVV4g.js";import"./snippet.CC5LXwbm.js";/* empty css                              */import"./index.CWH76EFj.js";import"./Introduction.TVXCexXh.js";import"./BentoCard.Cf8S9R1L.js";import"./scrollReveal.dHkz1Ob0.js";/* empty css                              *//* empty css                       */import"./layout-0254eb32.CMoy5ZUa.js";import"./clone-2c3335c5.fPzTt3ts.js";import"./edges-20fff4f5.BqOc4N0O.js";import"./createText-9372f704.D1mErU-l.js";import"./line-0c78f995.sZsUBZHE.js";import"./array-2ff2c7a6.C3YJfAyO.js";import"./path-428ebac9.B0oSrkCJ.js";const w="rect",k="rectWithTitle",rt="start",it="end",at="divider",nt="roundedWithTitle",dt="note",lt="noteGroup",u="statediagram",ct="state",pt=`${u}-${ct}`,P="transition",bt="note",gt="note-edge",mt=`${P} ${gt}`,ut=`${u}-${bt}`,ht="cluster",yt=`${u}-${ht}`,ft="cluster-alt",$t=`${u}-${ft}`,W="parent",j="note",xt="state",C="----",wt=`${C}${j}`,_=`${C}${W}`,q="fill:none",G="fill: #333",O="c",Y="text",U="normal";let T={},c=0;const Tt=function(t){const r=Object.keys(t);for(const e of r)t[e]},St=function(t,r){return r.db.extract(r.db.getRootDocV2()),r.db.getClasses()};function Dt(t){return t==null?"":t.classes?t.classes.join(" "):""}function B(t="",r=0,e="",i=C){const a=e!==null&&e.length>0?`${i}${e}`:"";return`${xt}-${t}${a}-${r}`}const x=(t,r,e,i,a,n)=>{const s=e.id,h=Dt(i[s]);if(s!=="root"){let g=w;e.start===!0&&(g=rt),e.start===!1&&(g=it),e.type!==M&&(g=e.type),T[s]||(T[s]={id:s,shape:g,description:v.sanitizeText(s,S()),classes:`${h} ${pt}`});const o=T[s];e.description&&(Array.isArray(o.description)?(o.shape=k,o.description.push(e.description)):o.description.length>0?(o.shape=k,o.description===s?o.description=[e.description]:o.description=[o.description,e.description]):(o.shape=w,o.description=e.description),o.description=v.sanitizeTextOrArray(o.description,S())),o.description.length===1&&o.shape===k&&(o.shape=w),!o.type&&e.doc&&(p.info("Setting cluster for ",s,E(e)),o.type="group",o.dir=E(e),o.shape=e.type===Q?at:nt,o.classes=o.classes+" "+yt+" "+(n?$t:""));const m={labelStyle:"",shape:o.shape,labelText:o.description,classes:o.classes,style:"",id:s,dir:o.dir,domId:B(s,c),type:o.type,padding:15};if(m.centerLabel=!0,e.note){const d={labelStyle:"",shape:dt,labelText:e.note.text,classes:ut,style:"",id:s+wt+"-"+c,domId:B(s,c,j),type:o.type,padding:15},l={labelStyle:"",shape:lt,labelText:e.note.text,classes:o.classes,style:"",id:s+_,domId:B(s,c,W),type:"group",padding:0};c++;const y=s+_;t.setNode(y,l),t.setNode(d.id,d),t.setNode(s,m),t.setParent(s,y),t.setParent(d.id,y);let b=s,f=d.id;e.note.position==="left of"&&(b=d.id,f=s),t.setEdge(b,f,{arrowhead:"none",arrowType:"",style:q,labelStyle:"",classes:mt,arrowheadStyle:G,labelpos:O,labelType:Y,thickness:U})}else t.setNode(s,m)}r&&r.id!=="root"&&(p.trace("Setting node ",s," to be child of its parent ",r.id),t.setParent(s,r.id)),e.doc&&(p.trace("Adding nodes children "),At(t,e,e.doc,i,a,!n))},At=(t,r,e,i,a,n)=>{p.trace("items",e),e.forEach(s=>{switch(s.stmt){case Z:x(t,r,s,i,a,n);break;case M:x(t,r,s,i,a,n);break;case X:{x(t,r,s.state1,i,a,n),x(t,r,s.state2,i,a,n);const h={id:"edge"+c,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:q,labelStyle:"",label:v.sanitizeText(s.description,S()),arrowheadStyle:G,labelpos:O,labelType:Y,thickness:U,classes:P};t.setEdge(s.state1.id,s.state2.id,h,c),c++}break}})},E=(t,r=J)=>{let e=r;if(t.doc)for(let i=0;i<t.doc.length;i++){const a=t.doc[i];a.stmt==="dir"&&(e=a.value)}return e},kt=async function(t,r,e,i){p.info("Drawing state diagram (v2)",r),T={},i.db.getDirection();const{securityLevel:a,state:n}=S(),s=n.nodeSpacing||50,h=n.rankSpacing||50;p.info(i.db.getRootDocV2()),i.db.extract(i.db.getRootDocV2()),p.info(i.db.getRootDocV2());const g=i.db.getStates(),o=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:E(i.db.getRootDocV2()),nodesep:s,ranksep:h,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});x(o,void 0,i.db.getRootDocV2(),g,i.db,!0);let m;a==="sandbox"&&(m=A("#i"+r));const d=a==="sandbox"?A(m.nodes()[0].contentDocument.body):A("body"),l=d.select(`[id="${r}"]`),y=d.select("#"+r+" g");await ot(y,o,["barb"],u,r);const b=8;et.insertTitle(l,"statediagramTitleText",n.titleTopMargin,i.db.getDiagramTitle());const f=l.node().getBBox(),L=f.width+b*2,R=f.height+b*2;l.attr("class",u);const V=l.node().getBBox();st(l,R,L,n.useMaxWidth);const z=`${V.x-b} ${V.y-b} ${L} ${R}`;p.debug(`viewBox ${z}`),l.attr("viewBox",z);const K=document.querySelectorAll('[id="'+r+'"] .edgeLabel .label');for(const D of K){const N=D.getBBox(),$=document.createElementNS("http://www.w3.org/2000/svg",w);$.setAttribute("rx",0),$.setAttribute("ry",0),$.setAttribute("width",N.width),$.setAttribute("height",N.height),D.insertBefore($,D.firstChild)}},Bt={setConf:Tt,getClasses:St,draw:kt},Ht={parser:H,db:I,renderer:Bt,styles:F,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,I.clear()}};export{Ht as diagram};
